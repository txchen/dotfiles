#!/bin/bash

set -euo pipefail

repo="https://github.com/tmux-plugins/tpm"
target_dir="{{ joinPath .chezmoi.homeDir ".tmux/plugins/tpm" }}"

mkdir -p "$(dirname "${target_dir}")"

if [ -d "${target_dir}/.git" ]; then
  git -C "${target_dir}" pull --ff-only
else
  rm -rf "${target_dir}"
  git clone "${repo}" "${target_dir}"
fi

if command -v tmux >/dev/null 2>&1; then
  tmux start-server >/dev/null 2>&1 || true
  TMUX_PLUGIN_MANAGER_PATH="$(dirname "${target_dir}")" "${target_dir}/bin/install_plugins" || true
fi
